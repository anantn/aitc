# HG changeset patch
# Parent 4af0c62e30a7ead77c1e41bd5043396211a3d7fa
Bug 760898: Set dom.mozApps.used when the Apps DOM API is used; r=fabrice

diff --git a/dom/apps/src/Webapps.jsm b/dom/apps/src/Webapps.jsm
--- a/dom/apps/src/Webapps.jsm
+++ b/dom/apps/src/Webapps.jsm
@@ -100,16 +100,20 @@ let DOMApplicationRegistry = {
     } catch (ex) {
       Cu.reportError("DOMApplicationRegistry: Could not read from " + aFile.path + " : " + ex);
       if (aCallback)
         aCallback(null);
     }
   },
 
   receiveMessage: function(aMessage) {
+    // nsIPrefBranch throws if pref does not exist, faster to simply write
+    // the pref instead of first checking if it is false.
+    Services.prefs.setBoolPref("dom.mozApps.used", true);
+
     let msg = aMessage.json;
 
     switch (aMessage.name) {
       case "Webapps:Install":
         // always ask for UI to install
         Services.obs.notifyObservers(this, "webapps-ask-install", JSON.stringify(msg));
         break;
       case "Webapps:GetSelf":
